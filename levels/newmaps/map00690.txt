LEVEL_VERSION(1)
SET_GENERATE_SPEED(400)


START_MONEY(PLAYER0,5000)
START_MONEY(PLAYER1,500000)
START_MONEY(PLAYER2,20000)
START_MONEY(PLAYER3,20000)

MAX_CREATURES(ALL_PLAYERS,25)

COMPUTER_PLAYER(PLAYER1,9)
COMPUTER_PLAYER(PLAYER2,7)
COMPUTER_PLAYER(PLAYER3,7)

ADD_CREATURE_TO_POOL(FLY,20)
ADD_CREATURE_TO_POOL(BUG,20)
ADD_CREATURE_TO_POOL(DEMONSPAWN,20)
ADD_CREATURE_TO_POOL(TROLL,20)
ADD_CREATURE_TO_POOL(SPIDER,20)
ADD_CREATURE_TO_POOL(HELL_HOUND,20)
ADD_CREATURE_TO_POOL(TENTACLE,20)
ADD_CREATURE_TO_POOL(SORCEROR,20)
ADD_CREATURE_TO_POOL(ORC,20)
ADD_CREATURE_TO_POOL(BILE_DEMON,20)
ADD_CREATURE_TO_POOL(DRAGON,20)
ADD_CREATURE_TO_POOL(DARK_MISTRESS,20)

CREATURE_AVAILABLE(ALL_PLAYERS,FLY,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,BUG,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,DEMONSPAWN,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,TROLL,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,SPIDER,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,HELL_HOUND,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,TENTACLE,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,SORCEROR,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,ORC,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,BILE_DEMON,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,DRAGON,1,0)
CREATURE_AVAILABLE(ALL_PLAYERS,DARK_MISTRESS,1,0)


ROOM_AVAILABLE(ALL_PLAYERS,TREASURE,3,0)
ROOM_AVAILABLE(ALL_PLAYERS,LAIR,3,0)
ROOM_AVAILABLE(ALL_PLAYERS,GARDEN,3,0)
ROOM_AVAILABLE(ALL_PLAYERS,TRAINING,3,0)
ROOM_AVAILABLE(ALL_PLAYERS,RESEARCH,3,0)
ROOM_AVAILABLE(PLAYER0,WORKSHOP,3,0)
ROOM_AVAILABLE(PLAYER1,WORKSHOP,1,0)
ROOM_AVAILABLE(PLAYER2,WORKSHOP,1,0)
ROOM_AVAILABLE(PLAYER3,WORKSHOP,1,0)
ROOM_AVAILABLE(PLAYER0,PRISON,4,0)
ROOM_AVAILABLE(PLAYER1,PRISON,1,0)
ROOM_AVAILABLE(PLAYER2,PRISON,1,0)
ROOM_AVAILABLE(PLAYER3,PRISON,1,0)

ROOM_AVAILABLE(PLAYER0,TORTURE,4,0)
ROOM_AVAILABLE(PLAYER2,TORTURE,1,0)
ROOM_AVAILABLE(PLAYER3,TORTURE,1,0)
ROOM_AVAILABLE(ALL_PLAYERS,BARRACKS,4,0)
ROOM_AVAILABLE(ALL_PLAYERS,TEMPLE,4,0)

MAGIC_AVAILABLE(ALL_PLAYERS,POWER_HAND,1,1)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_SLAP,1,1)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_POSSESS,1,1)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_IMP,1,1)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_SPEED,1,0)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_OBEY,1,0)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_CALL_TO_ARMS,1,0)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_CONCEAL,1,0)
MAGIC_AVAILABLE(ALL_PLAYERS,POWER_DESTROY_WALLS,1,0)

MAGIC_AVAILABLE(PLAYER1,POWER_HEAL_CREATURE,1,0)
MAGIC_AVAILABLE(PLAYER2,POWER_HEAL_CREATURE,1,0)
MAGIC_AVAILABLE(PLAYER3,POWER_HEAL_CREATURE,1,0)

MAGIC_AVAILABLE(PLAYER2,POWER_PROTECT,1,0)
MAGIC_AVAILABLE(PLAYER3,POWER_PROTECT,1,0)
MAGIC_AVAILABLE(PLAYER3,POWER_CHICKEN,1,0)
MAGIC_AVAILABLE(PLAYER3,POWER_DISEASE,1,0)

DOOR_AVAILABLE(ALL_PLAYERS,BRACED,1,0)
DOOR_AVAILABLE(ALL_PLAYERS,STEEL,1,0)
DOOR_AVAILABLE(ALL_PLAYERS,MAGIC,1,0)






HIDE_HERO_GATE(-3,1)
HIDE_HERO_GATE(-4,1)
HIDE_HERO_GATE(-5,1)
HIDE_HERO_GATE(-6,1)
HIDE_HERO_GATE(-7,1)
HIDE_HERO_GATE(-8,1)
HIDE_HERO_GATE(-9,1)
HIDE_HERO_GATE(-10,1)



SET_CREATURE_HEALTH(AVATAR,50000)
SET_CREATURE_ARMOUR(AVATAR,220)
SET_CREATURE_ARMOUR(KNIGHT,120)
SET_CREATURE_INSTANCE(AVATAR, 3, FIREBALL,1)
SET_CREATURE_INSTANCE(AVATAR, 5, FIRE_BOMB,5)
SET_CREATURE_INSTANCE(AVATAR, 9, SPEED,9)
SET_CREATURE_INSTANCE(KNIGHT, 4, SPEED,8)
SET_CREATURE_INSTANCE(SAMURAI, 6, HEAL,10)

SET_CREATURE_HEALTH(KNIGHT,20000)
SET_CREATURE_HEALTH(SAMURAI,20000)



REVEAL_MAP_RECT(Player0,243,16,9,9)

SET_GAME_RULE(ImpWorkExperience,524)

SET_GAME_RULE (TortureConvertChance,0)


SET_CREATURE_PROPERTY(TROLL,NO_IMPRISONMENT,1)
SET_CREATURE_PROPERTY(SKELETON,NO_IMPRISONMENT,1)
SET_CREATURE_PROPERTY(FAIRY,NO_IMPRISONMENT,1)
SET_CREATURE_PROPERTY(WITCH,NO_IMPRISONMENT,1)
SET_CREATURE_PROPERTY(KNIGHT,NO_IMPRISONMENT,1)
SET_CREATURE_PROPERTY(SAMURAI,NO_IMPRISONMENT,1)

IF(PLAYER0,TOTAL_CREATURES <28)
	IF(PLAYER0,FLAG7 == 1)
		NEXT_COMMAND_REUSABLE
 		SET_GAME_RULE (TortureConvertChance,100)
		QUICK_INFORMATION(27,"你现在可以招降无数的敌人了。",All_PLAYERS)
	ENDIF
ENDIF



SET_FLAG(PLAYER3,FLAG6,1)

IF(PLAYER0,TOTAL_CREATURES >28)
	IF (PLAYER3,FLAG6 == 1)
		NEXT_COMMAND_REUSABLE
 		SET_GAME_RULE (TortureConvertChance,0)
		QUICK_INFORMATION(8," 由于你拥有数量惊人的怪物，黑暗之神对你施了魔咒，阻止你进一步招降敌军。",All_PLAYERS)
	ENDIF
ENDIF



IF(PLAYER0,TOTAL_CREATURES >28)
	IF_ACTION_POINT(12,PLAYER0)
		SET_FLAG(PLAYER3,FLAG6,2)
		NEXT_COMMAND_REUSABLE
 		SET_GAME_RULE (TortureConvertChance,100)
		QUICK_INFORMATION(29," 你已得到黑暗之神的祝福，拥有无限招降的能力。",All_PLAYERS)
	ENDIF
ENDIF


IF(PLAYER0,TOTAL_CREATURES >=26)
	QUICK_INFORMATION(25,"邪恶的神灵正在监视你的一举一动，以及你忠实追随者的所作所为。如果你坚持要改变他人的信仰，一定要小心。",All_PLAYERS)
ENDIF


REMOVE_SACRIFICE_RECIPE(IMP)


IF(PLAYER0,SACRIFICED[IMP] >= 1)
  QUICK_INFORMATION(44, "众神不再需要任何小鬼。",ALL_PLAYERS)
  SET_SACRIFICE_RECIPE(NegUniqFunc,COSTLIER_IMPS,IMP)
ENDIF

IF(PLAYER0,TEMPLE >1)

	QUICK_INFORMATION(38, "请注意牺牲你的小鬼。",ALL_PLAYERS)

ENDIF




IF(PLAYER0,WORKSHOP >1)

	QUICK_INFORMATION(34, "你只能在这个王国设置 20 个陷阱。",ALL_PLAYERS)

ENDIF








IF(PLAYER0,VAMPIRE >= 1)
    NEXT_COMMAND_REUSABLE
    SET_GAME_RULE(BodiesForVampire,250)
ENDIF

IF(PLAYER0,VAMPIRE < 2)
    		NEXT_COMMAND_REUSABLE
    		SET_GAME_RULE(BodiesForVampire,7)
ENDIF

IF(PLAYER0,GHOST >= 2)
	NEXT_COMMAND_REUSABLE
	SET_GAME_RULE(GhostConvertChance,0)
ENDIF

IF(PLAYER0,GHOST < 3)
    		NEXT_COMMAND_REUSABLE
	SET_GAME_RULE(GhostConvertChance,100)
ENDIF

IF(PLAYER0,SKELETON >= 3)
	NEXT_COMMAND_REUSABLE
	SET_GAME_RULE(PrisonSkeletonChance,0)
ENDIF

IF(PLAYER0,SKELETON < 3)
		NEXT_COMMAND_REUSABLE
		SET_GAME_RULE (PrisonSkeletonChance,100)
ENDIF


IF_CONTROLS(PLAYER_GOOD,AVATAR < PLAYER_GOOD,AVATAR)

	SET_MUSIC(3)

ENDIF





CREATE_PARTY(MAGIC)
	ADD_TO_PARTY(MAGIC,WIZARD,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC,WITCH,10,550,ATTACK_DUNGEON_HEART,0)


CREATE_PARTY(MAGIC1)
	ADD_TO_PARTY(MAGIC1,WIZARD,8,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC1,FAIRY,8,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC1,THIEF,8,550,ATTACK_DUNGEON_HEART,0)


CREATE_PARTY(MAGIC2)
	ADD_TO_PARTY(MAGIC2,BARBARIAN,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC2,BARBARIAN,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC2,GIANT,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC2,GIANT,10,550,ATTACK_DUNGEON_HEART,0)




CREATE_PARTY(MAGIC3)
	ADD_TO_PARTY(MAGIC3,WIZARD,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC3,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC3,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC3,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC3,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)

CREATE_PARTY(MAGIC4)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC4,ARCHER,10,550,ATTACK_DUNGEON_HEART,0)


CREATE_PARTY(MAGIC5)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC5,DWARFA,10,550,ATTACK_DUNGEON_HEART,0)


CREATE_PARTY(MAGIC6)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC6,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)


CREATE_PARTY(MAGIC7)
	ADD_TO_PARTY(MAGIC7,SKELETON,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC7,BARBARIAN,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC7,GIANT,10,550,ATTACK_DUNGEON_HEART,0)
	ADD_TO_PARTY(MAGIC7,FAIRY,10,550,ATTACK_DUNGEON_HEART,0)

CREATE_PARTY(FINAL1)
	ADD_TO_PARTY(FINAL1,AVATAR,10,550,ATTACK_DUNGEON_HEART,0)


QUICK_OBJECTIVE(0,"这个王国由圣者，雷杰纳德勋爵统治。我们的目标是抓住他，并对他施以酷刑，直到他与我们结盟。他的能力远超我们迄今为止遇到的任何人。然而，我们迫切需要他，因为他掌握着地上领域的钥匙。你可以看到他在北方的住所里徘徊。",All_PLAYERS)






REM "LOOP"

SET_TIMER(PLAYER3,TIMER3)

IF(PLAYER3,TIMER3  >= 15)
	NEXT_COMMAND_REUSABLE
	COUNT_CREATURES_AT_ACTION_POINT(27,PLAYER0,IMP,PLAYER3,FLAG4)
	NEXT_COMMAND_REUSABLE
	ADD_TO_FLAG(PLAYER3,FLAG4,1)
	NEXT_COMMAND_REUSABLE
	SET_TIMER(PLAYER3,TIMER3)
ENDIF

REM "Search again for imp"

IF(PLAYER3,FLAG4 >= 10)

		CHANGE_SLAB_TYPE(2,60,PATH)
		CHANGE_SLAB_TYPE(3,60,PATH)
		CHANGE_SLAB_TYPE(3,61,PATH)
		CHANGE_SLAB_TYPE(2,61,PATH)

ENDIF



REM "LOOP"

SET_TIMER(PLAYER3,TIMER4)

IF(PLAYER3,TIMER4  >= 15)
	NEXT_COMMAND_REUSABLE
	COUNT_CREATURES_AT_ACTION_POINT(28,PLAYER0,IMP,PLAYER3,FLAG5)
	NEXT_COMMAND_REUSABLE
	ADD_TO_FLAG(PLAYER3,FLAG5,1)
	NEXT_COMMAND_REUSABLE
	SET_TIMER(PLAYER3,TIMER4)
ENDIF

REM "Search again for imp"

IF(PLAYER3,FLAG5 >= 10)

		CHANGE_SLAB_TYPE(82,62,PATH)
		CHANGE_SLAB_TYPE(82,61,PATH)
		CHANGE_SLAB_TYPE(82,60,PATH)
		CHANGE_SLAB_TYPE(80,61,PATH)
		CHANGE_SLAB_TYPE(80,62,PATH)
		CHANGE_SLAB_TYPE(81,62,PATH)
		CHANGE_SLAB_TYPE(81,60,PATH)
		CHANGE_SLAB_TYPE(80,60,PATH)

ENDIF


REM "LOOP"

SET_TIMER(PLAYER3,TIMER5)

IF(PLAYER3,TIMER5  >= 15)
	NEXT_COMMAND_REUSABLE
	COUNT_CREATURES_AT_ACTION_POINT(29,PLAYER0,IMP,PLAYER3,FLAG6)
	NEXT_COMMAND_REUSABLE
	ADD_TO_FLAG(PLAYER3,FLAG6,1)
	NEXT_COMMAND_REUSABLE
	SET_TIMER(PLAYER3,TIMER5)
ENDIF

REM "Search again for imp"

IF(PLAYER3,FLAG6 >= 10)

		CHANGE_SLAB_TYPE(41,2,PATH)
		CHANGE_SLAB_TYPE(40,3,PATH)
		CHANGE_SLAB_TYPE(41,3,PATH)
		CHANGE_SLAB_TYPE(42,3,PATH)

ENDIF



IF(PLAYER0,TOTAL_TRAPS_USED  >= 20)
	NEXT_COMMAND_REUSABLE
	TRAP_AVAILABLE(PLAYER0,POISON_GAS,0,0)
	NEXT_COMMAND_REUSABLE
	TRAP_AVAILABLE(PLAYER0,LIGHTNING,0,0)
	NEXT_COMMAND_REUSABLE
	TRAP_AVAILABLE(PLAYER0,WORD_OF_POWER,0,0)
	QUICK_INFORMATION(41,"您已达到最大陷阱数量。 ",All_PLAYERS)

ENDIF

IF(PLAYER0,TOTAL_TRAPS_USED  < 20)
	IF(PLAYER2,FLAG3 == 2)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,POISON_GAS,1,0)
	ENDIF
ENDIF

IF(PLAYER0,TOTAL_TRAPS_USED  < 20)
	IF(PLAYER2,FLAG3 == 3)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,POISON_GAS,1,0)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,LIGHTNING,1,0)
	ENDIF
ENDIF

IF(PLAYER0,TOTAL_TRAPS_USED  < 20)
	IF(PLAYER2,FLAG3 == 4)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,POISON_GAS,1,0)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,LIGHTNING,1,0)
		NEXT_COMMAND_REUSABLE
		TRAP_AVAILABLE(PLAYER0,WORD_OF_POWER,1,0)
	ENDIF
ENDIF


IF(PLAYER0,AVATAR == 0)
	IF(PLAYER_GOOD,AVATAR == 0)
		NEXT_COMMAND_REUSABLE
		ADD_PARTY_TO_LEVEL(PLAYER_GOOD,FINAL1,26,1)
	ENDIF
ENDIF


SET_FLAG(PLAYER1,FLAG1,1)

IF_ACTION_POINT(16,PLAYER0)
	SET_FLAG(PLAYER1,FLAG1,2)
ENDIF



IF_ACTION_POINT(17,PLAYER0)
	SET_FLAG(PLAYER1,FLAG1,2)
ENDIF




IF_ACTION_POINT(18,PLAYER0)
	SET_FLAG(PLAYER1,FLAG1,2)
ENDIF


IF(PLAYER1,FLAG1==2)

	SET_TIMER(PLAYER1,TIMER3)

ENDIF



IF(PLAYER1,TIMER3 > 0)
	QUICK_INFORMATION(5,"你听见了吗？这种情况表明，一个强大的生物迫切需要它的主人的出现。 ",All_PLAYERS)
ENDIF

IF(PLAYER1,TIMER3 >= 60)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF

IF(PLAYER1,TIMER3 >= 140)
	PLAY_MESSAGE(PLAYER0,SOUND,901)
ENDIF

IF(PLAYER1,TIMER3 >= 220)
	PLAY_MESSAGE(PLAYER0,SOUND,902)
ENDIF

IF(PLAYER1,TIMER3 >= 320)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF


IF(PLAYER1,TIMER3 >= 400)
	PLAY_MESSAGE(PLAYER0,SOUND,902)
ENDIF


IF(PLAYER1,TIMER3 >= 500)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF





IF_ACTION_POINT(1,PLAYER0)
	QUICK_INFORMATION(1,"这里没有吸引任何生物的入口。花时间仔细探索以获得有利位置，有些谜题可以帮助您获得一些生物。",All_PLAYERS)
ENDIF




IF_ACTION_POINT(3,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC,3,1)
ENDIF



IF_ACTION_POINT(2,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC1,-1,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC1,-2,1)
ENDIF


IF_ACTION_POINT(4,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC2,4,1)
ENDIF



IF_ACTION_POINT(5,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC4,5,1)
ENDIF


IF_ACTION_POINT(6,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC4,6,1)
ENDIF



IF_ACTION_POINT(7,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC3,7,1)
ENDIF



IF_ACTION_POINT(8,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC5,8,1)
ENDIF


IF_ACTION_POINT(9,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC5,9,1)
ENDIF


IF_ACTION_POINT(10,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC2,-4,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC2,-6,1)

	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC2,-3,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC2,-5,1)


ENDIF


IF_ACTION_POINT(11,PLAYER0)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC6,-8,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC6,-10,1)

	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC3,-7,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC3,-9,1)


ENDIF


IF_ACTION_POINT(12,PLAYER0)
	QUICK_INFORMATION(2,"请记住，我们的事业必须得到圣者的支持。",All_PLAYERS)
ENDIF


IF_ACTION_POINT(19,PLAYER0)
	CHANGE_SLAB_OWNER(13,53,PLAYER0)
	CHANGE_SLAB_OWNER(14,53,PLAYER0)

ENDIF


IF(PLAYER0,TREASURE >= 1)
	TUTORIAL_FLASH_BUTTON(6,-1)
ENDIF


IF(PLAYER0,GARDEN >= 1)
	TUTORIAL_FLASH_BUTTON(7,-1)
ENDIF


IF(PLAYER0,LAIR >= 1)
	TUTORIAL_FLASH_BUTTON(8,-1)
ENDIF


IF(PLAYER0,RESEARCH >= 1)
	TUTORIAL_FLASH_BUTTON(9,-1)
ENDIF


IF(PLAYER0,TRAINING >= 1)
	TUTORIAL_FLASH_BUTTON(10,-1)
ENDIF




SET_BOX_TOOLTIP(1,"魔法：这个盒子将为你的小鬼提供非凡的能力。")


IF(PLAYER0,BOX1_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	SET_CREATURE_INSTANCE(IMP, 5, FLY,1)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX1_ACTIVATED,0)
	PLAY_MESSAGE(PLAYER0,SOUND,335)
ENDIF




SET_BOX_TOOLTIP(2,"土地宝盒")

IF(PLAYER0,BOX2_ACTIVATED > 0)

	QUICK_INFORMATION(43,"通过使用这个盒子，土地区域被连接在一起。",24)




	USE_POWER_AT_POS(PLAYER_NEUTRAL,115,197,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,115,192,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,115,204,POWER_CAVE_IN,9,1)



	PLAY_MESSAGE(PLAYER0,SOUND,116)
	CHANGE_SLAB_TYPE(38,69,PATH)
	CHANGE_SLAB_TYPE(38,68,PATH)
	CHANGE_SLAB_TYPE(38,67,PATH)
	CHANGE_SLAB_TYPE(38,66,PATH)
	CHANGE_SLAB_TYPE(38,65,PATH)
	CHANGE_SLAB_TYPE(38,64,PATH)
	CHANGE_SLAB_TYPE(38,63,PATH)

ENDIF


SET_FLAG(PLAYER2,FLAG3,1)


SET_BOX_TOOLTIP(3,"毒气宝盒")

IF(PLAYER0,BOX3_ACTIVATED > 0)
	PLAY_MESSAGE(PLAYER0,SOUND,116)
	TRAP_AVAILABLE(PLAYER0,POISON_GAS,1,0)

	SET_FLAG(PLAYER2,FLAG3,2)

ENDIF



SET_BOX_TOOLTIP(5,"战斗宝盒")

IF(PLAYER0,BOX5_ACTIVATED > 0)


	QUICK_INFORMATION(42,"这个盒子会引发一场战斗。",23)

	USE_POWER_AT_POS(PLAYER_NEUTRAL,100,123,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,100,101,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,101,70,POWER_CAVE_IN,9,1)



	USE_POWER_AT_POS(PLAYER_NEUTRAL,101,88,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,100,114,POWER_CAVE_IN,9,1)
	USE_POWER_AT_POS(PLAYER_NEUTRAL,100,79,POWER_CAVE_IN,9,1)









	PLAY_MESSAGE(PLAYER0,SOUND,84)

	CHANGE_SLAB_TYPE(33,42,PATH)
	CHANGE_SLAB_TYPE(33,41,PATH)
	CHANGE_SLAB_TYPE(33,40,PATH)
	CHANGE_SLAB_TYPE(33,39,PATH)
	CHANGE_SLAB_TYPE(33,38,PATH)
	CHANGE_SLAB_TYPE(33,37,PATH)
	CHANGE_SLAB_TYPE(33,36,PATH)
	CHANGE_SLAB_TYPE(33,35,PATH)
	CHANGE_SLAB_TYPE(33,34,PATH)
	CHANGE_SLAB_TYPE(33,33,PATH)
	CHANGE_SLAB_TYPE(33,32,PATH)
	CHANGE_SLAB_TYPE(33,31,PATH)

	CHANGE_SLAB_TYPE(33,30,PATH)
	CHANGE_SLAB_TYPE(33,29,PATH)
	CHANGE_SLAB_TYPE(33,28,PATH)
	CHANGE_SLAB_TYPE(33,27,PATH)
	CHANGE_SLAB_TYPE(33,26,PATH)
	CHANGE_SLAB_TYPE(33,25,PATH)
	CHANGE_SLAB_TYPE(33,24,PATH)
	CHANGE_SLAB_TYPE(33,23,PATH)
	CHANGE_SLAB_TYPE(33,22,PATH)
	CHANGE_SLAB_TYPE(33,21,PATH)


ENDIF



SET_BOX_TOOLTIP(6,"金钱宝盒")

IF(PLAYER0,BOX6_ACTIVATED > 0)

	QUICK_INFORMATION(36,"这个盒子可以实现一片金田。",25)



	PLAY_MESSAGE(PLAYER0,SOUND,116)

	CHANGE_SLAB_TYPE(52,55,PATH)
	CHANGE_SLAB_TYPE(48,55,PATH)
ENDIF




SET_BOX_TOOLTIP(7,"闪电陷阱。")

IF(PLAYER0,BOX7_ACTIVATED > 0)
	PLAY_MESSAGE(PLAYER0,SOUND,335)
	TRAP_AVAILABLE(ALL_PLAYERS,LIGHTNING,1,0)
	SET_FLAG(PLAYER2,FLAG3,3)

ENDIF




SET_BOX_TOOLTIP(8,"能量陷阱。")

IF(PLAYER0,BOX8_ACTIVATED > 0)
	PLAY_MESSAGE(PLAYER0,SOUND,335)
	TRAP_AVAILABLE(ALL_PLAYERS,WORD_OF_POWER,1,0)
	SET_FLAG(PLAYER2,FLAG3,4)
ENDIF



SET_BOX_TOOLTIP(9,"英雄堡垒宝盒")

IF(PLAYER0,BOX9_ACTIVATED > 0)


	QUICK_INFORMATION(49,"使用此盒子，即可使用英雄堡垒。",22)


	USE_POWER_AT_POS(PLAYER_NEUTRAL,109,139,POWER_CAVE_IN,9,1)



	PLAY_MESSAGE(PLAYER0,SOUND,116)
	CHANGE_SLAB_TYPE(34,46,PATH)
	CHANGE_SLAB_TYPE(35,46,PATH)
	CHANGE_SLAB_TYPE(36,46,PATH)
	CHANGE_SLAB_TYPE(37,46,PATH)
	CHANGE_SLAB_TYPE(38,46,PATH)
	CHANGE_SLAB_TYPE(39,46,PATH)



	CHANGE_SLAB_TYPE(34,45,PATH)
	CHANGE_SLAB_TYPE(34,44,PATH)
	CHANGE_SLAB_TYPE(34,43,PATH)
	CHANGE_SLAB_TYPE(34,42,PATH)
	CHANGE_SLAB_TYPE(34,41,PATH)
	CHANGE_SLAB_TYPE(34,40,PATH)
	CHANGE_SLAB_TYPE(34,39,PATH)
	CHANGE_SLAB_TYPE(34,38,PATH)
	CHANGE_SLAB_TYPE(34,37,PATH)
	CHANGE_SLAB_TYPE(34,36,PATH)
	CHANGE_SLAB_TYPE(34,35,PATH)
	CHANGE_SLAB_TYPE(34,34,PATH)
	CHANGE_SLAB_TYPE(34,33,PATH)
	CHANGE_SLAB_TYPE(34,32,PATH)
	CHANGE_SLAB_TYPE(34,31,PATH)

	CHANGE_SLAB_TYPE(34,30,PATH)
	CHANGE_SLAB_TYPE(34,29,PATH)
	CHANGE_SLAB_TYPE(34,28,PATH)
	CHANGE_SLAB_TYPE(34,27,PATH)
	CHANGE_SLAB_TYPE(34,26,PATH)
	CHANGE_SLAB_TYPE(34,25,PATH)
	CHANGE_SLAB_TYPE(34,24,PATH)
	CHANGE_SLAB_TYPE(34,23,PATH)
	CHANGE_SLAB_TYPE(34,22,PATH)










ENDIF




SET_BOX_TOOLTIP(10,"提示")

IF(PLAYER0,BOX10_ACTIVATED > 0)
	PLAY_MESSAGE(PLAYER0,SOUND,335)
	QUICK_INFORMATION(3,"黄色守护者拥有建造桥梁的力量。",All_PLAYERS)
ENDIF




SET_BOX_TOOLTIP(11,"守护者争斗宝盒")



IF(PLAYER0,BOX11_ACTIVATED > 0)



	USE_POWER_AT_POS(PLAYER_NEUTRAL,57,46,POWER_CAVE_IN,9,1)



	QUICK_INFORMATION(11,"为黄色守护者开辟道路。",21)

	PLAY_MESSAGE(PLAYER0,SOUND,84)

	CHANGE_SLAB_TYPE(53,45,PATH)

	CHANGE_SLAB_TYPE(53,46,PATH)
	CHANGE_SLAB_TYPE(54,46,PATH)
	CHANGE_SLAB_TYPE(55,46,PATH)
	CHANGE_SLAB_TYPE(56,46,PATH)
	CHANGE_SLAB_TYPE(57,46,PATH)

	CHANGE_SLAB_TYPE(58,46,PATH)
	CHANGE_SLAB_TYPE(59,46,PATH)
	CHANGE_SLAB_TYPE(60,46,DIRT)


	CHANGE_SLAB_TYPE(39,47,PATH)
	CHANGE_SLAB_TYPE(40,47,PATH)
	CHANGE_SLAB_TYPE(41,47,PATH)
	CHANGE_SLAB_TYPE(42,47,PATH)
	CHANGE_SLAB_TYPE(43,47,PATH)
	CHANGE_SLAB_TYPE(44,47,PATH)
	CHANGE_SLAB_TYPE(45,47,PATH)
	CHANGE_SLAB_TYPE(46,47,PATH)
	CHANGE_SLAB_TYPE(47,47,PATH)
	CHANGE_SLAB_TYPE(48,47,PATH)
	CHANGE_SLAB_TYPE(49,47,PATH)
	CHANGE_SLAB_TYPE(50,47,PATH)
	CHANGE_SLAB_TYPE(51,47,PATH)
	CHANGE_SLAB_TYPE(52,47,PATH)
	CHANGE_SLAB_TYPE(53,47,PATH)


ENDIF


SET_BOX_TOOLTIP(12,"桥。")

IF(PLAYER0,BOX12_ACTIVATED > 0)

	PLAY_MESSAGE(PLAYER0,SOUND,335)
	ROOM_AVAILABLE(PLAYER0,BRIDGE,1,1)
	TUTORIAL_FLASH_BUTTON(18,-1)

ENDIF



SET_BOX_TOOLTIP(13,"闪电术。")

IF(PLAYER0,BOX13_ACTIVATED > 0)
	PLAY_MESSAGE(PLAYER0,SOUND,335)
	MAGIC_AVAILABLE(PLAYER0,POWER_LIGHTNING,1,0)
ENDIF







SET_BOX_TOOLTIP(14,"岛屿宝盒")

IF(PLAYER0,BOX14_ACTIVATED > 0)


	QUICK_INFORMATION(40,"在两个宝藏岛之间建立起联系。",25)



	USE_POWER_AT_POS(PLAYER_NEUTRAL,151,166,POWER_CAVE_IN,9,1)




	PLAY_MESSAGE(PLAYER0,SOUND,116)
	CHANGE_SLAB_TYPE(52,55,PATH)
	CHANGE_SLAB_TYPE(51,55,PATH)
	CHANGE_SLAB_TYPE(50,55,PATH)
	CHANGE_SLAB_TYPE(49,55,PATH)
	CHANGE_SLAB_TYPE(48,55,PATH)

ENDIF





SET_BOX_TOOLTIP(15,"毒气陷阱。")

IF(PLAYER0,BOX15_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,94)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX15_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)


ENDIF


SET_BOX_TOOLTIP(16,"毒气陷阱。")

IF(PLAYER0,BOX16_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,95)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX16_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)
ENDIF


SET_BOX_TOOLTIP(17,"毒气陷阱。")

IF(PLAYER0,BOX17_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,96)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX17_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)
ENDIF


SET_BOX_TOOLTIP(18,"毒气陷阱。")

IF(PLAYER0,BOX18_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,97)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX18_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)
ENDIF




SET_BOX_TOOLTIP(19,"毒气陷阱。")

IF(PLAYER0,BOX19_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,98)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX19_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)
ENDIF




SET_BOX_TOOLTIP(20,"毒气陷阱。")

IF(PLAYER0,BOX20_ACTIVATED > 0)
	NEXT_COMMAND_REUSABLE
	PLAY_MESSAGE(PLAYER0,SOUND,99)
	NEXT_COMMAND_REUSABLE
	SET_FLAG(PLAYER0,BOX20_ACTIVATED,0)
	NEXT_COMMAND_REUSABLE
	CREATE_EFFECT(16,LAST_EVENT)
ENDIF




SET_BOX_TOOLTIP(21,"招降宝盒：您现在可以使用酷刑室招降敌人。")

IF(PLAYER0,BOX21_ACTIVATED > 0)
	SET_GAME_RULE (TortureConvertChance,100)
	PLAY_MESSAGE(PLAYER0,SOUND,116)
	SET_FLAG(PLAYER0,FLAG7,1)
ENDIF





SET_BOX_TOOLTIP(22,"进一步移动盒子。")

IF(PLAYER0,BOX22_ACTIVATED > 0)
		CHANGE_SLAB_TYPE(33,54,PATH)
		CHANGE_SLAB_TYPE(33,53,PATH)
		CHANGE_SLAB_TYPE(33,52,PATH)
		CHANGE_SLAB_TYPE(33,51,PATH)
		CHANGE_SLAB_TYPE(33,50,PATH)
		CHANGE_SLAB_TYPE(33,49,PATH)
		CHANGE_SLAB_TYPE(33,48,PATH)
		CHANGE_SLAB_TYPE(33,47,PATH)
		CHANGE_SLAB_TYPE(33,46,PATH)
		CHANGE_SLAB_TYPE(33,45,PATH)
		CHANGE_SLAB_TYPE(33,44,PATH)
		CHANGE_SLAB_TYPE(33,43,PATH)
		CHANGE_SLAB_TYPE(32,43,PATH)
		CHANGE_SLAB_TYPE(31,43,PATH)
		PLAY_MESSAGE(PLAYER0,SOUND,116)

	QUICK_INFORMATION(22,"向英勇的勇士揭示通道和神秘的战利品。",20)


ENDIF



SET_BOX_TOOLTIP(23,"金子宝盒：为你的努力赠与一点金币。")

IF(PLAYER0,BOX23_ACTIVATED > 0)


	ADD_GOLD_TO_PLAYER(PLAYER0,10000)

ENDIF






SET_TIMER(PLAYER0,TIMER2)


IF(PLAYER0,TIMER2 >= 40)
	PLAY_MESSAGE(PLAYER0,SOUND,45)
	PLAY_MESSAGE(PLAYER0,SOUND,973)
ENDIF

IF(PLAYER0,TIMER2 >= 140)
	PLAY_MESSAGE(PLAYER0,SOUND,45)
ENDIF

IF(PLAYER0,TIMER2 >= 300)
	PLAY_MESSAGE(PLAYER0,SOUND,45)
ENDIF

IF(PLAYER0,TIMER2 >= 400)
	PLAY_MESSAGE(PLAYER0,SOUND,45)
ENDIF






IF(PLAYER0,TIMER7 >= 1)

	QUICK_INFORMATION(30,"他再次向他的主人求助。",All_PLAYERS)

ENDIF

IF(PLAYER0,TIMER7 >= 60)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF

IF(PLAYER0,TIMER7 >= 140)
	PLAY_MESSAGE(PLAYER0,SOUND,901)
ENDIF

IF(PLAYER0,TIMER7 >= 220)
	PLAY_MESSAGE(PLAYER0,SOUND,902)
ENDIF

IF(PLAYER0,TIMER7 >= 320)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF


IF(PLAYER0,TIMER7 >= 400)
	PLAY_MESSAGE(PLAYER0,SOUND,902)
ENDIF


IF(PLAYER0,TIMER7 >= 500)
	PLAY_MESSAGE(PLAYER0,SOUND,900)
ENDIF




IF(PLAYER1,TIMER0 == 80)
	NEXT_COMMAND_REUSABLE
	USE_POWER_AT_LOCATION(PLAYER0,30,POWER_LIGHTNING,7,1)

ENDIF

IF(PLAYER1,TIMER0 == 160)
	NEXT_COMMAND_REUSABLE
	USE_POWER_AT_LOCATION(PLAYER0,31,POWER_LIGHTNING,7,1)

ENDIF


IF(PLAYER1,TIMER0 == 240)
	NEXT_COMMAND_REUSABLE
	USE_POWER_AT_LOCATION(PLAYER0,32,POWER_LIGHTNING,7,1)

ENDIF

IF(PLAYER1,TIMER0 == 320)
	NEXT_COMMAND_REUSABLE
	USE_POWER_AT_LOCATION(PLAYER0,33,POWER_LIGHTNING,7,1)


ENDIF

IF(PLAYER1,TIMER0 == 321)
	NEXT_COMMAND_REUSABLE
	SET_TIMER(PLAYER1,TIMER0)

ENDIF





IF(PLAYER0,GHOST == 1)

	QUICK_INFORMATION(13,"这个鬼魂在合适的守护者掌控下会非常有用，所以要小心致命的雷暴。",All_PLAYERS)


	SET_TIMER(PLAYER1,TIMER0)


ENDIF







SET_CREATURE_HEALTH(HORNY,25000)
SET_CREATURE_ARMOUR(HORNY,200)
SET_CREATURE_INSTANCE(HORNY, 9, TELEPORT,1)
SET_CREATURE_INSTANCE(HORNY, 8, WORD_OF_POWER,1)
SET_CREATURE_INSTANCE(HORNY, 2, FLY,1)
SET_CREATURE_INSTANCE(HORNY, 7, FART,1)
SET_CREATURE_INSTANCE(HORNY, 3, POISON_CLOUD,1)
SET_CREATURE_INSTANCE(HORNY, 4, HEAL,1)
SET_CREATURE_INSTANCE(HORNY, 6, DRAIN,1)

SET_CREATURE_STRENGTH(HORNY,255)



CHANGE_CREATURES_ANNOYANCE(ALL_PLAYERS,HORNY,SET,0) 

IF(PLAYER0,HORNY == 1)

	PLAY_MESSAGE(PLAYER0,SOUND,335)
	QUICK_INFORMATION(6,"这个邪恶的生物是撒旦的化身。",All_PLAYERS)

ENDIF

IF_SLAB_TYPE(75,5,PRETTY_PATH)

	SET_FLAG(PLAYER2,FLAG3,1)

ENDIF


IF_SLAB_TYPE(75,5,PATH)

	SET_FLAG(PLAYER2,FLAG3,1)

ENDIF

IF(PLAYER2,FLAG3 == 1)
  SET_TIMER(PLAYER3,TIMER3)
ENDIF

IF(PLAYER3,TIMER3 > 50)
	SET_MUSIC(7)
ENDIF


IF(PLAYER_GOOD,DUNGEON_DESTROYED == 1)

	QUICK_INFORMATION(7," 英雄们正在赶来，渴望支援他们的国王。 ",All_PLAYERS)
	SET_TIMER(PLAYER0,TIMER1)

ENDIF


IF(PLAYER0,TIMER1 >= 1000)

	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC7,13,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC7,14,1)
	ADD_PARTY_TO_LEVEL(PLAYER_GOOD,MAGIC7,15,1)

ENDIF






IF(PLAYER2,DUNGEON_DESTROYED == 1)

	SET_TIMER(PLAYER0,TIMER7)

	CHANGE_SLAB_TYPE(62,15,LAVA)
	CHANGE_SLAB_TYPE(62,16,LAVA)

ENDIF




IF(PLAYER3,DUNGEON_DESTROYED == 1)

	MAGIC_AVAILABLE(ALL_PLAYERS,POWER_DESTROY_WALLS,0,0)

ENDIF


IF(PLAYER0,ALL_DUNGEONS_DESTROYED == 1)
	IF(PLAYER_GOOD,AVATAR == 0)
		IF(PLAYER0,AVATAR == 1)
				WIN_GAME

		ENDIF
	ENDIF
ENDIF
